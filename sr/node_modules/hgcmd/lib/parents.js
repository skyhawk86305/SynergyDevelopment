'use strict';

function parents(hgcmd, repoPath, callback) {
    var VARIABLES = ['branch', 'node|short', 'p1node|short', 'p2node|short'],
        TEMPLATE = '\\{';

    for (var idx in VARIABLES) {
        if (idx > 0) {
            TEMPLATE += ',';
        }
        TEMPLATE += '"' + VARIABLES[idx].split('|')[0] + '"' +
                    ':' +
                    '"{' + VARIABLES[idx] + '}"';
    }
    TEMPLATE += '}';

    hgcmd(repoPath, 'parents', ['-T' + TEMPLATE], function (err, outputs) {
        if (err) {
            return callback(err);
        } else if (outputs instanceof Array && outputs.length > 0) {
            var results = [];
            try {
                for (var idx in outputs) {
                    results.push(JSON.parse(outputs[idx]));
                }
                return callback(null, results);
            } catch (parseErr) {
                return callback(parseErr);
            }
        } else {
            console.error(outputs);
            return callback(new Error('can\'t determine parents'));
        }
    });
}

module.exports = parents;
