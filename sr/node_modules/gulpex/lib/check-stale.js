'use strict';

var assert = require('assert'),
    hgstale = require('./hgstale'),
    _ = require('lodash');

function checkStale(warn, root, done) {
    assert.equal(typeof warn, 'function');
    assert.equal(typeof root, 'string');
    assert.equal(typeof done, 'function');

    hgstale(root, function (err, staleMap) {
        if (err) {
            if (err.message === hgstale.NOT_IN_REPO) {
                warn('hg repository not initialized');
            } else {
                return done(err);
            }
        }

        if (staleMap) {
            warn('stale files detected');
        }

        done();
    });
}

module.exports = _.curry(checkStale);
