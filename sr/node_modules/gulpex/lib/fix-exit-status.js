'use strict';

var gutil = require('gulp-util');

function fixExitStatus(gulp) {
    var exitStatus = 0;

    gulp.on('err', function (err) {
        exitStatus = 1;
        console.log(err.err.stack);
    });

    process.on('exit', function (status) {
        if (status < exitStatus) {
            var repr = gutil.colors.magenta(exitStatus);
            gutil.log('Raising exit code to', repr, 'after task failure');
            process.exit(exitStatus);
        }
    });
}

module.exports = fixExitStatus;
