'use strict';

var lab = require('lab');

var AuthStub = require('authstub');

lab.experiment('the authentication stub', function() {
    var log,
        stub;

    lab.before(function (done) {
        var bunyan = require('bunyan'); // require before; clean up after
        log = bunyan.createLogger({ name: 'authstub' });
        var server = new AuthStub(log);
        server.start(function forceTestFailureOnErrors(err) {
            if (!err) {
                stub = server;
            }
            done(err);
        });
    });

    lab.after(function (done) {
        stub.close(done);
        delete global.fpath; // otherwise leaked by bunyan or its deps
    });

    lab.test('runs OK', function (done) {
        lab.expect(stub).to.be.a('object');
        done();
    });
});
