'use strict';

var lab = require('lab'),
    makeBench = require('./lib/bench'),
    hapi = require('hapi'),
    https = require('https');

lab.experiment('routes with config.auth = \'nobody\'', function() {
    var bench = makeBench();
    lab.before(bench.before);
    lab.after(bench.after);

    lab.test('issue 403 without calling the handler', function (done) {
        bench.server.route({
            path: '/test',
            method: 'GET',
            config: {
                auth: 'nobody'
            },
            handler: function (request, reply) {
                reply(hapi.error.badImplementation('should not be called'));
            }
        });

        https.get(bench.makeGetOptions('/test'), function (res) {
            lab.expect(res.statusCode).to.equal(403);
            done();
        });
    });
});

lab.experiment('routes with config.auth left undefined', function() {
    var bench = makeBench();
    lab.before(bench.before);
    lab.after(bench.after);

    lab.test('issue 403 without calling the handler', function (done) {
        bench.server.route({
            path: '/test',
            method: 'GET',
            handler: function (request, reply) {
                reply(hapi.error.badImplementation('should not be called'));
            }
        });

        https.get(bench.makeGetOptions('/test'), function (res) {
            lab.expect(res.statusCode).to.equal(403);
            done();
        });
    });
});

