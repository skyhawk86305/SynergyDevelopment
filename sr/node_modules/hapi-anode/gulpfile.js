'use strict';

var gulp = require('gulp'),
    gulpex = require('gulpex')(gulp),
    oopen = require('open'); // 'open' gave jshint headache

var paths = {
        output: {
            'coverage': [ 'coverage.html' ],
            'jsdoc': [ 'doc/**' ],
            'pack': [ '*.tgz' ]
        }
    };

gulp.task('default', [ 'test', 'posttest' ]);

gulp.task('posttest', [ 'lint', 'doc', 'coverage', 'check-stale', 'check-dep-links' ]);

gulp.task('test', gulpex.run('lab -v'));

gulp.task('coverage', [ 'test' ], gulpex.run('lab -c -o coverage.html -r html'));

gulp.task('lint', gulpex.run('jshint lib test gulpfile.js'));

gulp.task('doc', gulpex.run('jsdoc -c jsdoc.json -d doc -r lib'));

gulp.task('clean', gulpex.clean(paths.output));

gulp.task('check-deps', gulpex.run('david --warn404'));

gulp.task('check-stale', gulpex.checkStale(__dirname));

gulp.task('check-dep-links', gulpex.checkDepLinks(__dirname));

gulp.task('watch', [ 'default' ], function () {
    gulp.watch([ 'lib/**', 'gulpfile.js', 'test/**' ], [ 'default' ]);
});

gulp.task('twatch', [ 'test', 'lint' ], function () {
    gulp.watch([ 'lib/**', 'gulpfile.js', 'test/**' ], [ 'test', 'lint' ]);
});

gulp.task('serve', ['watch'], function (callback) {
    var BenchTest = require('hapi-bench-test');
    (new BenchTest()).start(callback);
});

gulp.task('open', ['serve'], function () {
    oopen('http://0.0.0.0:8000');
});
